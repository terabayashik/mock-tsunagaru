import{a as f,w as q}from"./chunk-QMGIS6GS-npKyu-26.js";import{j as e}from"./jsx-runtime-D_zvdyIk.js";import{u as v,a as K,I as Q,T as d,b as X,l as Z,e as ee,m as te}from"./modal-DDjUobDH.js";import{P as N,T as m,A as D,B as R}from"./TextInput-DMku8_7E.js";import{B as b,G as z,C as T}from"./react-Bl1EszzN.js";import{T as re,G as A,k as Y,m as V,F as _,e as k,L as se}from"./layout-CG8-yu9n.js";import{H as U,I as oe,B as ae}from"./IconList-DDBipvuP.js";import{L as W}from"./LayoutFormModal-wNST5pET.js";import{a as ne}from"./utils-BA-NeLEp.js";import{A as ie,I as le}from"./IconExclamationCircle-DgxA9N8q.js";import{m as de}from"./events-CgSWVLLi.js";import"./createReactComponent-Bo4FKQF2.js";import"./index-Bt7hW1Ho.js";import"./use-delayed-hover-C8bZQnj-.js";import"./use-mantine-color-scheme-Bh-JJ2Z9.js";const ce=({opened:t,onClose:a,onSubmit:o})=>e.jsx(W,{opened:t,onClose:a,onSubmit:o,title:"新しいレイアウトを作成",submitButtonText:"作成"}),G=[{bg:"rgba(74, 144, 226, 0.2)",border:"#4a90e2"},{bg:"rgba(82, 196, 26, 0.2)",border:"#52c41a"},{bg:"rgba(250, 173, 20, 0.2)",border:"#faad14"},{bg:"rgba(245, 34, 45, 0.2)",border:"#f5222d"}],H=1920,$=1080,he=t=>t==="portrait-right"||t==="portrait-left"?{width:$,height:H}:{width:H,height:$},ue=({layout:t,onClick:a,onEdit:o,onDelete:l})=>{const[i,u]=f.useState(null),[L,j]=f.useState(!0),[n,h]=f.useState(200),y=f.useRef(null),{getLayoutById:E}=v();f.useEffect(()=>{const p=()=>{if(y.current){const r=y.current.getBoundingClientRect();h(r.width)}};p(),window.addEventListener("resize",p);const w=new ResizeObserver(p);return y.current&&w.observe(y.current),()=>{window.removeEventListener("resize",p),w.disconnect()}},[]),f.useEffect(()=>{(async()=>{try{j(!0);const w=await E(t.id);u(w)}catch(w){console.error("Failed to load layout details:",w)}finally{j(!1)}})()},[t.id,E]);const x=he(t.orientation),g=n,c=g/x.width,C=x.height*c,I=Math.round(C)+60,M=()=>!i||L?e.jsx(_,{w:"100%",h:"100%",align:"center",justify:"center",bg:"gray.0",c:"gray.5",fz:"xs",children:L?"読み込み中...":"プレビュー未対応"}):e.jsx(b,{w:"100%",h:"100%",pos:"relative",bg:"#f8f9fa",children:i.regions.map((p,w)=>{const r=G[w%G.length];return e.jsxs(_,{pos:"absolute",bg:r.bg,fz:"8px",c:"white",fw:700,align:"center",justify:"center",style:{left:`${p.x*c}px`,top:`${p.y*c}px`,width:`${p.width*c}px`,height:`${p.height*c}px`,border:`1px solid ${r.border}`,borderRadius:"2px",textShadow:"1px 1px 2px rgba(0,0,0,0.6)"},children:["リージョン ",w+1]},p.id)})}),B=()=>{switch(t.orientation){case"landscape":return"#228be6";case"portrait-right":return"#fa8c16";case"portrait-left":return"#722ed1";default:return"#40c057"}};return e.jsxs(N,{ref:y,withBorder:!0,p:0,w:"100%",h:I,style:{cursor:a?"pointer":"default"},onClick:a,children:[e.jsx(b,{pos:"relative",children:e.jsx(b,{style:{height:`${C}px`,width:`${g}px`,overflow:"hidden",position:"relative"},children:M()})}),e.jsxs(b,{p:"xs",h:"60px",style:{overflow:"hidden"},children:[e.jsx(re,{label:t.name,disabled:t.name.length<=20,children:e.jsx(m,{size:"sm",fw:500,lineClamp:1,children:t.name})}),e.jsxs(A,{justify:"space-between",align:"center",mt:4,children:[e.jsxs(A,{gap:"xs",children:[e.jsx(m,{size:"xs",c:"dimmed",children:new Date(t.createdAt).toLocaleDateString("ja-JP")}),e.jsx(m,{size:"xs",style:{color:B(),fontWeight:500},children:t.orientation==="landscape"?"横向き":t.orientation==="portrait-right"?"縦向き(右)":"縦向き(左)"})]}),e.jsxs(A,{gap:"xs",children:[o&&e.jsx(D,{size:"xs",variant:"subtle",color:"blue",onClick:p=>{p.stopPropagation(),o(t)},"aria-label":"編集",children:e.jsx(Y,{size:12})}),l&&e.jsx(D,{size:"xs",variant:"subtle",color:"red",onClick:p=>{p.stopPropagation(),l(t)},"aria-label":"削除",children:e.jsx(V,{size:12})})]})]})]})]})},xe=({layouts:t,loading:a,onLayoutClick:o,onLayoutEdit:l,onLayoutDelete:i})=>a?e.jsx(k,{cols:{base:1,sm:2,md:3,lg:4},spacing:"md",children:Array.from({length:8},()=>crypto.randomUUID()).map(u=>e.jsx(b,{h:"200px",bg:"#f8f9fa",style:{borderRadius:"8px"}},u))}):t.length===0?e.jsx(m,{ta:"center",c:"dimmed",mt:"xl",children:"レイアウトがありません"}):e.jsxs(e.Fragment,{children:[e.jsx(k,{cols:{base:1,sm:2,md:3,lg:4},spacing:"md",children:t.map(u=>e.jsx(ue,{layout:u,onClick:()=>o==null?void 0:o(u),onEdit:l,onDelete:i},u.id))}),e.jsxs(m,{ta:"center",c:"dimmed",mt:"md",size:"sm",children:["全 ",t.length," 件のレイアウトを表示しました"]})]}),O=[{bg:"rgba(74, 144, 226, 0.2)",border:"#4a90e2"},{bg:"rgba(82, 196, 26, 0.2)",border:"#52c41a"},{bg:"rgba(250, 173, 20, 0.2)",border:"#faad14"},{bg:"rgba(245, 34, 45, 0.2)",border:"#f5222d"}],pe=1920,me=1080,ge=({layout:t,children:a,disabled:o=!1})=>{const[l,i]=f.useState(null),[u,L]=f.useState(!0),{getLayoutById:j}=v(),n=400,h=n/pe,y=me*h;if(f.useEffect(()=>{o||(async()=>{try{L(!0);const g=await j(t.id);i(g)}catch(g){console.error("Failed to load layout details:",g)}finally{L(!1)}})()},[t.id,j,o]),o)return e.jsx(e.Fragment,{children:a});const E=()=>u?e.jsx(_,{w:n,h:300,align:"center",justify:"center",children:e.jsx(m,{size:"sm",c:"dimmed",children:"読み込み中..."})}):l?e.jsxs(N,{withBorder:!0,p:0,w:n,children:[e.jsxs(b,{pos:"relative",children:[e.jsx(b,{style:{height:y,width:"100%",position:"relative",backgroundColor:"#f8f9fa",overflow:"hidden"},children:l.regions.map((x,g)=>{const c=O[g%O.length];return e.jsxs(b,{style:{position:"absolute",left:`${x.x*h}px`,top:`${x.y*h}px`,width:`${x.width*h}px`,height:`${x.height*h}px`,backgroundColor:c.bg,border:`1px solid ${c.border}`,borderRadius:"2px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"10px",color:c.border,fontWeight:700},children:["リージョン ",g+1]},x.id)})}),e.jsx(b,{pos:"absolute",top:"8px",left:"8px",px:"8px",py:"4px",style:{backgroundColor:t.orientation==="landscape"?"#228be6":t.orientation==="portrait-right"?"#fa8c16":"#722ed1",color:"white",borderRadius:"4px",fontSize:"11px",fontWeight:600},children:t.orientation==="landscape"?"横向き":t.orientation==="portrait-right"?"縦向き(右)":"縦向き(左)"})]}),e.jsxs(b,{p:"md",children:[e.jsx(m,{size:"md",fw:600,lineClamp:1,mb:"xs",children:t.name}),e.jsxs(A,{justify:"space-between",mb:"xs",children:[e.jsxs(m,{size:"xs",c:"dimmed",children:["リージョン数: ",t.regionCount]}),e.jsx(m,{size:"xs",c:"dimmed",children:new Date(t.createdAt).toLocaleDateString("ja-JP")})]}),l&&e.jsxs(b,{children:[e.jsx(m,{size:"xs",c:"dimmed",mb:"xs",children:"リージョン詳細:"}),l.regions.map((x,g)=>{const c=O[g%O.length];return e.jsxs(A,{gap:"xs",mb:4,children:[e.jsx(b,{style:{width:"12px",height:"12px",backgroundColor:c.bg,border:`1px solid ${c.border}`,borderRadius:"2px"}}),e.jsxs(m,{size:"xs",children:["リージョン ",g+1,": ",Math.round(x.width),"×",Math.round(x.height)]})]},x.id)})]})]})]}):e.jsx(_,{w:n,h:300,direction:"column",align:"center",justify:"center",children:e.jsx(m,{size:"xs",c:"dimmed",ta:"center",children:"レイアウトプレビュー未対応"})});return e.jsxs(U,{width:n,shadow:"md",openDelay:300,closeDelay:100,position:"right",withArrow:!0,children:[e.jsx(U.Target,{children:a}),e.jsx(U.Dropdown,{p:0,children:E()})]})},fe=({opened:t,layoutId:a,onClose:o,onSubmit:l})=>{const[i,u]=f.useState(null),[L,j]=f.useState(!1),[n,h]=f.useState(!1),{getLayoutById:y}=v();f.useEffect(()=>{t&&a?(async()=>{j(!0),h(!1);try{const c=await y(a);u(c),h(!0)}catch(c){console.error("Failed to load layout data:",c),u(null),h(!1)}finally{j(!1)}})():(u(null),h(!1))},[t,a,y]);const E=()=>{u(null),h(!1),o()};if(t&&a&&(!n||!i))return null;const x=i?{name:i.name,orientation:i.orientation,regions:i.regions}:void 0;return e.jsx(W,{opened:t&&n&&!!i,onClose:E,onSubmit:l,title:"レイアウトを編集",submitButtonText:"保存",initialData:x})},S=z([]),F=z(!1),J=z(null),je=ne("layoutViewMode","table"),ye=z(null,(t,a,o)=>{switch(o.type){case"SET_LAYOUTS":a(S,o.layouts);break;case"SET_LOADING":a(F,o.loading);break;case"SET_ERROR":a(J,o.error);break;case"ADD_LAYOUT":a(S,l=>[...l,o.layout]);break;case"UPDATE_LAYOUT":a(S,l=>l.map(i=>i.id===o.layout.id?o.layout:i));break;case"REMOVE_LAYOUT":a(S,l=>l.filter(i=>i.id!==o.id));break}}),Me=q(function(){const[a]=T(S),[o]=T(F),[l]=T(J),[i,u]=T(je),[L]=T(Z),[j]=T(ee),[,n]=T(ye),[,h]=T(te),{getLayoutsIndex:y,deleteLayout:E,createLayout:x,updateLayout:g}=v();f.useEffect(()=>{(async()=>{n({type:"SET_LOADING",loading:!0}),n({type:"SET_ERROR",error:null});try{const s=await y();n({type:"SET_LAYOUTS",layouts:s})}catch(s){n({type:"SET_ERROR",error:s instanceof Error?s.message:"不明なエラーが発生しました"})}finally{n({type:"SET_LOADING",loading:!1})}})()},[y,n]);const c=r=>{h({type:"OPEN_LAYOUT_EDIT",layoutId:r})},C=async r=>{de.openConfirmModal({title:"レイアウトを削除",children:e.jsx(m,{size:"sm",children:"このレイアウトを削除しますか？この操作は元に戻せません。"}),labels:{confirm:"削除",cancel:"キャンセル"},confirmProps:{color:"red"},onConfirm:async()=>{try{await E(r),n({type:"REMOVE_LAYOUT",id:r})}catch(s){n({type:"SET_ERROR",error:s instanceof Error?s.message:"削除に失敗しました"})}}})},I=()=>{h({type:"OPEN_LAYOUT_CREATE"})},M=async r=>{try{const s=await x({name:r.name,orientation:r.orientation,regions:r.regions}),P={id:s.id,name:s.name,orientation:s.orientation,regionCount:s.regions.length,createdAt:s.createdAt,updatedAt:s.updatedAt};n({type:"ADD_LAYOUT",layout:P})}catch(s){throw n({type:"SET_ERROR",error:s instanceof Error?s.message:"レイアウトの作成に失敗しました"}),s}},B=()=>{h({type:"CLOSE_LAYOUT_CREATE"})},p=async r=>{if(j.layoutId)try{const s=await g(j.layoutId,{name:r.name,orientation:r.orientation,regions:r.regions}),P={id:s.id,name:s.name,orientation:s.orientation,regionCount:s.regions.length,createdAt:s.createdAt,updatedAt:s.updatedAt};n({type:"UPDATE_LAYOUT",layout:P})}catch(s){throw n({type:"SET_ERROR",error:s instanceof Error?s.message:"レイアウトの更新に失敗しました"}),s}},w=()=>{h({type:"CLOSE_LAYOUT_EDIT"})};return e.jsxs(b,{pos:"relative",children:[e.jsx(se,{visible:o}),l&&!l.includes("Failed to read JSON")&&e.jsx(ie,{icon:e.jsx(le,{size:16}),color:"red",mb:"md",children:l}),e.jsxs(A,{justify:"space-between",mb:"md",children:[e.jsx(A,{gap:"sm",children:e.jsxs(R.Group,{children:[e.jsx(R,{variant:i==="table"?"filled":"default",color:"blue",onClick:()=>u("table"),"aria-label":"テーブルビュー",children:e.jsx(oe,{size:18})}),e.jsx(R,{variant:i==="grid"?"filled":"default",color:"blue",onClick:()=>u("grid"),"aria-label":"グリッドビュー",children:e.jsx(K,{size:18})})]})}),e.jsx(R,{leftSection:e.jsx(Q,{size:16}),onClick:I,children:"新しいレイアウトを作成"})]}),i==="table"?e.jsxs(d,{striped:!0,highlightOnHover:!0,children:[e.jsx(d.Thead,{children:e.jsxs(d.Tr,{children:[e.jsx(d.Th,{w:40}),e.jsx(d.Th,{children:"操作"}),e.jsx(d.Th,{children:"名前"}),e.jsx(d.Th,{children:"向き"}),e.jsx(d.Th,{children:"リージョン数"}),e.jsx(d.Th,{children:"作成日時"}),e.jsx(d.Th,{children:"操作"})]})}),e.jsx(d.Tbody,{children:a.length===0&&!o?e.jsx(d.Tr,{children:e.jsx(d.Td,{colSpan:7,ta:"center",c:"dimmed",children:"レイアウトがありません"})}):a.map(r=>e.jsxs(d.Tr,{children:[e.jsx(d.Td,{children:e.jsx(ge,{layout:r,children:e.jsx(D,{variant:"subtle",color:"gray",size:"sm","aria-label":"プレビュー",children:e.jsx(X,{size:16})})})}),e.jsx(d.Td,{children:e.jsx(D,{variant:"subtle",color:"blue",size:"sm",onClick:()=>c(r.id),"aria-label":"編集",children:e.jsx(Y,{size:16})})}),e.jsx(d.Td,{children:e.jsx(m,{fw:500,children:r.name})}),e.jsx(d.Td,{children:e.jsx(ae,{color:r.orientation==="landscape"?"blue":r.orientation==="portrait-right"?"orange":"violet",variant:"light",children:r.orientation==="landscape"?"横向き":r.orientation==="portrait-right"?"縦向き(右)":"縦向き(左)"})}),e.jsx(d.Td,{children:e.jsx(m,{children:r.regionCount})}),e.jsx(d.Td,{children:e.jsx(m,{children:new Date(r.createdAt).toLocaleString("ja-JP")})}),e.jsx(d.Td,{children:e.jsx(D,{variant:"subtle",color:"red",size:"sm",onClick:()=>C(r.id),"aria-label":"削除",children:e.jsx(V,{size:16})})})]},r.id))})]}):e.jsx(xe,{layouts:a,loading:o,onLayoutClick:r=>{c(r.id)},onLayoutEdit:r=>c(r.id),onLayoutDelete:r=>C(r.id)}),e.jsx(ce,{opened:L,onClose:B,onSubmit:M}),e.jsx(fe,{opened:j.opened,layoutId:j.layoutId,onClose:w,onSubmit:p})]})});export{Me as default};
