import{w as V,a as g}from"./chunk-QMGIS6GS-npKyu-26.js";import{j as e}from"./jsx-runtime-D_zvdyIk.js";import{A as Q}from"./AuthGuard-D8QPU2f0.js";import"./content-D7L0e-wr.js";import{C as X,D as A,h as Y,r as Z}from"./user--7Rf_7ES.js";import"./ContentGridView-Dtgkrepm.js";import{b as ee,g as R,n as se}from"./ContentAddModal-C_1kSIvW.js";import{j as te,l as O,S as l,G as f,m as $}from"./layout-CG8-yu9n.js";import{a as u}from"./notifications.store-COrBkbcJ.js";import{I as C,A as w}from"./IconExclamationCircle-DgxA9N8q.js";import{T as b}from"./Title-C5nX2t57.js";import{P,T as s,B as k}from"./TextInput-DMku8_7E.js";import{c as re,a as M}from"./createReactComponent-Bo4FKQF2.js";import{m as N}from"./events-CgSWVLLi.js";import{l as q,i as J,B as K,o as ie,q as oe,m as ne,J as ae,H as le,C as H}from"./react-Bl1EszzN.js";import"./utils-BA-NeLEp.js";import"./get-contrast-color-B-kutpjz.js";import"./index-Bt7hW1Ho.js";const[ce,de]=re("List component was not found in tree");var T={root:"m_abbac491",item:"m_abb6bec2",itemWrapper:"m_75cd9f71",itemIcon:"m_60f83e5b"};const me={},E=q((r,c)=>{const i=J("ListItem",me,r),{classNames:h,className:x,style:p,styles:y,vars:z,icon:m,children:v,mod:j,...S}=i,o=de(),n=m||o.icon,a={classNames:h,styles:y};return e.jsx(K,{...o.getStyles("item",{...a,className:x,style:p}),component:"li",mod:[{"with-icon":!!n,centered:o.center},j],ref:c,...S,children:e.jsxs("div",{...o.getStyles("itemWrapper",a),children:[n&&e.jsx("span",{...o.getStyles("itemIcon",a),children:n}),e.jsx("span",{...o.getStyles("itemLabel",a),children:v})]})})});E.classes=T;E.displayName="@mantine/core/ListItem";const he={type:"unordered"},xe=oe((r,{size:c,spacing:i})=>({root:{"--list-fz":le(c),"--list-lh":ae(c),"--list-spacing":ne(i)}})),d=q((r,c)=>{const i=J("List",he,r),{classNames:h,className:x,style:p,styles:y,unstyled:z,vars:m,children:v,type:j,withPadding:S,icon:o,spacing:n,center:a,listStyleType:F,mod:B,...L}=i,I=ie({name:"List",classes:T,props:i,className:x,style:p,classNames:h,styles:y,unstyled:z,vars:m,varsResolver:xe});return e.jsx(ce,{value:{center:a,icon:o,getStyles:I},children:e.jsx(K,{...I("root",{style:{listStyleType:F}}),component:j==="unordered"?"ul":"ol",mod:[{"with-padding":S},B],ref:c,...L,children:v})})});d.classes=T;d.displayName="@mantine/core/List";d.Item=E;/**
 * @license @tabler/icons-react v3.34.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var G=M("outline","database-off","IconDatabaseOff",[["path",{d:"M12.983 8.978c3.955 -.182 7.017 -1.446 7.017 -2.978c0 -1.657 -3.582 -3 -8 -3c-1.661 0 -3.204 .19 -4.483 .515m-2.783 1.228c-.471 .382 -.734 .808 -.734 1.257c0 1.22 1.944 2.271 4.734 2.74",key:"svg-0"}],["path",{d:"M4 6v6c0 1.657 3.582 3 8 3c.986 0 1.93 -.067 2.802 -.19m3.187 -.82c1.251 -.53 2.011 -1.228 2.011 -1.99v-6",key:"svg-1"}],["path",{d:"M4 12v6c0 1.657 3.582 3 8 3c3.217 0 5.991 -.712 7.261 -1.74m.739 -3.26v-4",key:"svg-2"}],["path",{d:"M3 3l18 18",key:"svg-3"}]]);/**
 * @license @tabler/icons-react v3.34.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var pe=M("outline","palette","IconPalette",[["path",{d:"M12 21a9 9 0 0 1 0 -18c4.97 0 9 3.582 9 8c0 1.06 -.474 2.078 -1.318 2.828c-.844 .75 -1.989 1.172 -3.182 1.172h-2.5a2 2 0 0 0 -1 3.75a1.3 1.3 0 0 1 -1 2.25",key:"svg-0"}],["path",{d:"M8.5 10.5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0",key:"svg-1"}],["path",{d:"M12.5 7.5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0",key:"svg-2"}],["path",{d:"M16.5 10.5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0",key:"svg-3"}]]);/**
 * @license @tabler/icons-react v3.34.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var je=M("outline","refresh-dot","IconRefreshDot",[["path",{d:"M20 11a8.1 8.1 0 0 0 -15.5 -2m-.5 -4v4h4",key:"svg-0"}],["path",{d:"M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4",key:"svg-1"}],["path",{d:"M12 12m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0",key:"svg-2"}]]);/**
 * @license @tabler/icons-react v3.34.0 - MIT
 *
 * This source code is licensed under the MIT license.
 * See the LICENSE file in the root directory of this source tree.
 */var W=M("outline","refresh","IconRefresh",[["path",{d:"M20 11a8.1 8.1 0 0 0 -15.5 -2m-.5 -4v4h4",key:"svg-0"}],["path",{d:"M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4",key:"svg-1"}]]);const Oe=r=>[{title:"設定 - Tsunagaru"},{name:"description",content:"設定ページ"}],ge=()=>{const[r,c]=g.useState(null),[i,h]=g.useState(!1),[x,p]=g.useState(!1),[y,z]=g.useState(!1),m=te.getInstance(),{regenerateAllThumbnails:v}=ee(),[j,S]=H(Y),[,o]=H(Z),n=g.useCallback(async()=>{try{h(!0);const t=await m.getStorageInfo();c(t)}catch(t){O.error("Settings","Failed to load storage info",t),u.show({title:"エラー",message:"ストレージ情報の読み込みに失敗しました",color:"red",icon:e.jsx(C,{size:16})})}finally{h(!1)}},[m]);g.useEffect(()=>{n()},[n]);const a=t=>{if(!t)return"不明";if(t===0)return"0 B";const _=1024,U=["B","KB","MB","GB"],D=Math.floor(Math.log(t)/Math.log(_));return`${Number.parseFloat((t/_**D).toFixed(2))} ${U[D]}`},F=()=>{N.openConfirmModal({title:"OPFS データの完全削除",children:e.jsxs(l,{gap:"md",children:[e.jsx(w,{color:"red",icon:e.jsx(C,{size:16}),children:e.jsx(s,{size:"sm",fw:500,children:"この操作は元に戻せません！"})}),e.jsx(s,{size:"sm",children:"以下のデータがすべて削除されます："}),e.jsxs(d,{size:"sm",children:[e.jsx(d.Item,{children:"すべてのプレイリスト"}),e.jsx(d.Item,{children:"すべてのレイアウト"}),e.jsx(d.Item,{children:"すべてのコンテンツファイル"}),e.jsx(d.Item,{children:"アプリケーションの設定"})]}),e.jsxs(s,{size:"sm",c:"dimmed",children:["現在の使用量: ",a(r==null?void 0:r.estimatedSize)," (",(r==null?void 0:r.files.length)||0," ファイル)"]})]}),labels:{confirm:"すべて削除",cancel:"キャンセル"},confirmProps:{color:"red",leftSection:e.jsx($,{size:16})},onConfirm:B})},B=async()=>{try{p(!0),await m.clearAll(),u.show({title:"削除完了",message:"OPFSデータをすべて削除しました",color:"green",icon:e.jsx(G,{size:16})}),await n()}catch(t){O.error("Settings","Failed to clear OPFS",t),u.show({title:"削除失敗",message:"データの削除中にエラーが発生しました",color:"red",icon:e.jsx(C,{size:16})})}finally{p(!1)}},L=()=>{N.openConfirmModal({title:"サムネイル一括再生成",children:e.jsxs(l,{gap:"md",children:[e.jsx(w,{color:"blue",icon:e.jsx(R,{size:16}),children:e.jsx(s,{size:"sm",fw:500,children:"すべてのコンテンツのサムネイルを再生成します"})}),e.jsx(s,{size:"sm",children:"この操作により、既存のサムネイル画像がすべて最新の設定で再生成されます。 アスペクト比の修正が適用され、動画のオリジナルアスペクト比が保持されます。"}),e.jsx(s,{size:"sm",c:"dimmed",children:"処理時間はコンテンツ数に応じて数分かかる場合があります。"})]}),labels:{confirm:"再生成を開始",cancel:"キャンセル"},confirmProps:{color:"blue",leftSection:e.jsx(W,{size:16})},onConfirm:I})},I=async()=>{try{z(!0);const t=await v();t.failed.length>0?u.show({title:"一部のサムネイル再生成に失敗",message:`${t.success}/${t.total} 件が成功しました。失敗: ${t.failed.join(", ")}`,color:"yellow",icon:e.jsx(C,{size:16}),autoClose:1e4}):u.show({title:"サムネイル再生成完了",message:`${t.success} 件のサムネイルを再生成しました`,color:"green",icon:e.jsx(R,{size:16})}),await n()}catch(t){O.error("Settings","Failed to regenerate thumbnails",t),u.show({title:"サムネイル再生成失敗",message:"サムネイルの再生成中にエラーが発生しました",color:"red",icon:e.jsx(C,{size:16})})}finally{z(!1)}};return e.jsx(Q,{children:e.jsx(X,{size:"lg",children:e.jsxs(l,{gap:"lg",children:[e.jsx(b,{order:1,children:"設定"}),e.jsx(P,{p:"md",withBorder:!0,children:e.jsxs(l,{gap:"md",children:[e.jsx(b,{order:2,size:"h3",children:"ストレージ管理"}),e.jsx(w,{color:"blue",icon:e.jsx(G,{size:16}),children:e.jsx(s,{size:"sm",children:"このアプリケーションはブラウザのOPFS (Origin Private File System) を使用してデータを保存しています。"})}),i?e.jsx(s,{size:"sm",c:"dimmed",children:"読み込み中..."}):r?e.jsxs(l,{gap:"xs",children:[e.jsxs(f,{justify:"space-between",children:[e.jsx(s,{size:"sm",fw:500,children:"使用容量:"}),e.jsx(s,{size:"sm",children:a(r.estimatedSize)})]}),e.jsxs(f,{justify:"space-between",children:[e.jsx(s,{size:"sm",fw:500,children:"ディレクトリ数:"}),e.jsx(s,{size:"sm",children:r.directories.length})]}),e.jsxs(f,{justify:"space-between",children:[e.jsx(s,{size:"sm",fw:500,children:"ファイル数:"}),e.jsx(s,{size:"sm",children:r.files.length})]})]}):e.jsx(s,{size:"sm",c:"red",children:"ストレージ情報の読み込みに失敗しました"}),e.jsxs(f,{justify:"space-between",mt:"md",children:[e.jsx(k,{variant:"subtle",onClick:n,loading:i,size:"sm",children:"情報を更新"}),e.jsx(k,{color:"red",variant:"light",leftSection:e.jsx($,{size:16}),onClick:F,loading:x,disabled:i,children:"すべてのデータを削除"})]})]})}),e.jsx(P,{p:"md",withBorder:!0,children:e.jsxs(l,{gap:"md",children:[e.jsx(b,{order:2,size:"h3",children:"サムネイル管理"}),e.jsx(w,{color:"blue",icon:e.jsx(R,{size:16}),children:e.jsx(s,{size:"sm",children:"コンテンツのサムネイル画像を一括で再生成できます。 アスペクト比の修正や品質向上のために使用してください。"})}),e.jsx(f,{justify:"flex-end",children:e.jsx(k,{color:"blue",variant:"light",leftSection:e.jsx(W,{size:16}),onClick:L,loading:y,disabled:i||x,children:"サムネイルを一括再生成"})})]})}),e.jsx(P,{p:"md",withBorder:!0,children:e.jsxs(l,{gap:"md",children:[e.jsx(b,{order:2,size:"h3",children:"テーマ設定"}),e.jsx(w,{color:"blue",icon:e.jsx(pe,{size:16}),children:e.jsx(s,{size:"sm",children:"アプリケーションの外観をカスタマイズできます。 変更は自動的に保存され、リロード後も保持されます。"})}),e.jsxs(l,{gap:"sm",children:[e.jsxs(f,{align:"end",gap:"md",children:[e.jsx(se,{label:"ヘッダー色",description:"アプリケーションヘッダーの背景色を変更します",value:j,onChange:S,format:"hex",swatches:[A,"#0A529C","#1971C2","#0C8599","#087F5B","#2F9E44","#66A80F","#E8590C","#D9480F"],flex:1}),e.jsx(k,{variant:"light",leftSection:e.jsx(je,{size:16}),onClick:()=>o(),disabled:j===A,children:"デフォルトに戻す"})]}),e.jsxs(s,{size:"xs",c:"dimmed",children:["デフォルト色: ",A]})]})]})}),e.jsx(P,{p:"md",withBorder:!0,children:e.jsxs(l,{gap:"md",children:[e.jsx(b,{order:2,size:"h3",children:"その他の設定"}),e.jsx(s,{size:"sm",c:"dimmed",children:"その他の設定項目は今後実装予定です。"})]})})]})})})},Te=V(ge);export{Te as default,Oe as meta};
